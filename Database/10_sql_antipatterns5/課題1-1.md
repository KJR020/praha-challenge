# 課題1-1

## 課題内容

Salesforceのようなサービスを想像してみてください。
以下のようなテーブルで新規顧客の営業進捗を管理しているとします。

```sql
TABLE NewCustomer {
  id: varchar
  called: boolean -- 電話をかけたらTRUEになる。FALSEの人には電話をかけなければいけない
  callNote: varchar -- 電話をかけた時に交わした内容のメモ
  metOnce: boolean -- アポで面談したらTRUEになる
  metAt: date -- 面談をした日付が入る
  closed: boolean -- 成約した
  closedAt: date -- 成約した日付が入る
}
```

上記の設計だとどのような問題が生じるか、説明してください。

<aside>
💡 ヒント

- 例えば商談の数が増えたらどうなるでしょうか？
- 仮に面談を3回実施して、1回目の面談日時を知りたい時はどうすれば良いのでしょうか？
- 例えば一度成約した後に解約し、後にまた同じ人が成約したらどうなるでしょうか？
</aside>

## 回答

- 以下のような問題がある

- 1. 複数回イベントが発生した場合のスキーマ変更が必要となる
  - 電話/商談といった複数回になり得るイベントを`NewCustomer`テーブルのカラムで表現している
  - 電話、面談が複数回それぞれ記録する場合、`callMemo`, `metAt`カラムを増やす必要がある

- 2. 未使用のカラムが多くなる
  - 全ての顧客に、電話、面談、成約カラムが存在する
  - 電話時点で商談不成立の場合にNULLやデフォルト値を含むカラムでテーブルが肥大化する

- 3. 面談/電話/成約の書き込みが発生するタイミングが異なる
  - １レコードに対して３回以上のユースケースで更新される
  - アプリケーションロジックが別々で更新箇所が分散し、整合性を保つのが困難になる
