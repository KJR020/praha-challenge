# 課題1-1

## 課題内容

サービスに新しく退会機能を加えることになりました。
とあるエンジニアは、登録しているユーザーが退会済みか否か判断できるよう以下のようなフラグを追加しました。

```sql
TABLE Student {
  id: varchar
  name: varchar
  taikaiFlag: boolean <- これを追加
}
```

この対応にはどのような問題点が潜んでいるでしょうか？

<aside>
💡 こちらは「とりあえず削除フラグ」という名前のついた有名なアンチパターンです。このフレーズで調べてみると良いかもしれません！

</aside>

## 回答

- この対応は「とりあえず削除フラグ」と呼ばれるアンチパターンに該当する
  - 物理削除の代わりに論理削除を行うために、削除フラグを追加する手法

- 問題点は以下の通り

### クエリの複雑化
- すべてのクエリで削除フラグを考慮する必要がある
  - `SELECT * FROM Student WHERE taikaiFlag = false`のように、常に条件を追加しなければならない
  - 条件の追加漏れによるバグが発生しやすい
  - 特に複雑な結合クエリでは、すべてのテーブルで削除フラグを考慮する必要がある
- ORMのモデルなど、defaultで`delete=false`を取得する実装も可能だが、明示的でなくクエリを書く際に認識の齟齬が生じやすい

## 参考
- [SQLアンチパターン 幻の第26章「とりあえず削除フラグ」 | PPT](https://www.slideshare.net/slideshow/ronsakucasual/52256922#14 )
